<!doctype html>
<html lang="en" data-theme="light">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="apple-mobile-web-app-title" content="Peptide Dashboard" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="theme-color" content="#3498db" />
    <title>Peptide Research Dashboard</title>
    <link rel="manifest" href="manifest.json" />
    <link rel="icon" type="image/png" sizes="192x192" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>🧬</text></svg>" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/date-fns@2.29.3/index.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <style>
      body {
        max-width: 1200px;
        margin: 0 auto;
        padding: 32px 40px;
        position: relative;
        box-sizing: border-box;
        font-family: 'Inter', Arial, sans-serif;
        line-height: 1.6;
        color: #2c3e50;
      }

      .header {
        text-align: center;
        margin-bottom: 40px;
        padding-bottom: 20px;
        border-bottom: 3px solid #3498db;
      }

      .header h1 {
        color: #2c3e50;
        font-size: 2.5rem;
        margin-bottom: 10px;
        font-weight: 600;
      }

      .nav-menu {
        display: flex;
        justify-content: center;
        flex-wrap: wrap;
        gap: 20px;
        margin-top: 20px;
      }

      .nav-item {
        background: #ecf0f1;
        padding: 8px 16px;
        border-radius: 4px;
        text-decoration: none;
        color: #2c3e50;
        font-weight: 500;
        border: 1px solid #bdc3c7;
      }

      .section {
        margin-bottom: 50px;
        background: #ffffff;
        padding: 30px;
        border: 1px solid #e0e0e0;
        border-radius: 8px;
      }

      .section h2 {
        color: #2980b9;
        border-bottom: 2px solid #3498db;
        padding-bottom: 10px;
        margin-bottom: 25px;
        font-size: 1.8rem;
      }

      .section h3 {
        color: #34495e;
        margin-top: 25px;
        margin-bottom: 15px;
        font-size: 1.3rem;
      }

      .grid-2 {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 30px;
      }

      .grid-3 {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr;
        gap: 20px;
      }

      .subsection {
        background: #f8f9fa;
        padding: 20px;
        border-left: 4px solid #3498db;
        margin-bottom: 20px;
      }

      .tracking-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 15px;
        background: white;
      }

      .tracking-table th {
        background: #3498db;
        color: white;
        padding: 12px 8px;
        text-align: left;
        font-weight: 500;
        border: 1px solid #2980b9;
      }

      .tracking-table td {
        padding: 10px 8px;
        border: 1px solid #ddd;
        background: #fafafa;
      }

      .input-field {
        width: 100%;
        padding: 8px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 14px;
      }

      .protocol-card {
        background: #f8f9fa;
        border: 1px solid #dee2e6;
        padding: 20px;
        margin-bottom: 20px;
        border-radius: 6px;
      }

      .protocol-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
        margin-top: 15px;
      }

      .label {
        font-weight: 500;
        color: #495057;
        margin-bottom: 5px;
      }

      .cheat-category {
        background: #e8f4f8;
        border: 1px solid #b8dce8;
        padding: 20px;
        margin-bottom: 25px;
        border-radius: 6px;
      }

      .cheat-category h4 {
        color: #2980b9;
        margin-bottom: 15px;
        font-size: 1.2rem;
      }

      .peptide-list {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 15px;
      }

      .peptide-item {
        background: white;
        padding: 15px;
        border: 1px solid #ddd;
        border-radius: 4px;
      }

      .peptide-name {
        font-weight: 600;
        color: #2c3e50;
        margin-bottom: 5px;
      }

      .peptide-purpose {
        font-size: 14px;
        color: #6c757d;
      }

      .status-active {
        background: #d4edda;
        color: #155724;
      }
      .status-planned {
        background: #fff3cd;
        color: #856404;
      }
      .status-completed {
        background: #f8d7da;
        color: #721c24;
      }

      .vendor-card {
        background: #f8f9fa;
        border: 1px solid #dee2e6;
        padding: 20px;
        margin-bottom: 20px;
        border-radius: 6px;
      }

      .vendor-info {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin-top: 15px;
      }

      /* Dark Mode Styles */
      [data-theme="dark"] {
        --background-color: #1a1a1a;
        --text-color: #e0e0e0;
        --section-bg: #2d2d2d;
        --border-color: #404040;
        --accent-color: #4CAF50;
      }

      [data-theme="dark"] body {
        background-color: var(--background-color);
        color: var(--text-color);
      }

      [data-theme="dark"] .section {
        background-color: var(--section-bg);
        border-color: var(--border-color);
      }

      /* Advanced UI Components */
      .dashboard-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .stat-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 20px;
        border-radius: 12px;
        text-align: center;
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        transition: transform 0.3s ease;
      }

      .stat-card:hover {
        transform: translateY(-5px);
      }

      .stat-number {
        font-size: 2.5rem;
        font-weight: 700;
        margin-bottom: 5px;
      }

      .stat-label {
        font-size: 0.9rem;
        opacity: 0.9;
      }

      .interactive-table {
        position: relative;
      }

      .table-controls {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
        flex-wrap: wrap;
        gap: 10px;
      }

      .search-box {
        display: flex;
        align-items: center;
        gap: 10px;
        flex: 1;
        min-width: 200px;
      }

      .search-input {
        flex: 1;
        padding: 8px 12px;
        border: 1px solid #ddd;
        border-radius: 6px;
        font-size: 14px;
      }

      .btn {
        padding: 8px 16px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 500;
        transition: all 0.3s ease;
        display: inline-flex;
        align-items: center;
        gap: 8px;
      }

      .btn-primary {
        background: #3498db;
        color: white;
      }

      .btn-primary:hover {
        background: #2980b9;
      }

      .btn-success {
        background: #27ae60;
        color: white;
      }

      .btn-warning {
        background: #f39c12;
        color: white;
      }

      .btn-danger {
        background: #e74c3c;
        color: white;
      }

      .btn-small {
        padding: 4px 8px;
        font-size: 12px;
      }

      /* Modal Styles */
      .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0,0,0,0.5);
      }

      .modal-content {
        background-color: white;
        margin: 5% auto;
        padding: 30px;
        border-radius: 12px;
        width: 90%;
        max-width: 600px;
        max-height: 80vh;
        overflow-y: auto;
      }

      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 1px solid #eee;
      }

      .close {
        color: #aaa;
        font-size: 28px;
        font-weight: bold;
        cursor: pointer;
      }

      .close:hover {
        color: #000;
      }

      .form-group {
        margin-bottom: 20px;
      }

      .form-label {
        display: block;
        margin-bottom: 5px;
        font-weight: 500;
        color: #495057;
      }

      .form-control {
        width: 100%;
        padding: 10px 12px;
        border: 1px solid #ddd;
        border-radius: 6px;
        font-size: 14px;
        transition: border-color 0.3s ease;
      }

      .form-control:focus {
        outline: none;
        border-color: #3498db;
        box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
      }

      /* Chart Container */
      .chart-container {
        position: relative;
        height: 300px;
        margin: 20px 0;
        background: white;
        border-radius: 8px;
        padding: 20px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      }

      /* Calculator Styles */
      .calculator-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
      }

      .calc-result {
        background: #e8f5e8;
        border: 2px solid #4CAF50;
        padding: 15px;
        border-radius: 8px;
        margin-top: 15px;
      }

      .calc-result strong {
        color: #2e7d32;
      }

      /* Progress Bar */
      .progress-container {
        background: #f0f0f0;
        border-radius: 10px;
        padding: 3px;
        margin: 10px 0;
      }

      .progress-bar {
        background: linear-gradient(90deg, #4CAF50, #45a049);
        height: 20px;
        border-radius: 8px;
        transition: width 0.5s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 12px;
        font-weight: bold;
      }

      /* Alert Styles */
      .alert {
        padding: 15px;
        margin-bottom: 20px;
        border: 1px solid transparent;
        border-radius: 6px;
      }

      .alert-warning {
        color: #856404;
        background-color: #fff3cd;
        border-color: #ffeaa7;
      }

      .alert-danger {
        color: #721c24;
        background-color: #f8d7da;
        border-color: #f1c0c7;
      }

      .alert-info {
        color: #0c5460;
        background-color: #d1ecf1;
        border-color: #b6d4db;
      }

      /* Theme Toggle */
      .theme-toggle {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 1000;
        background: #3498db;
        color: white;
        border: none;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        cursor: pointer;
        font-size: 18px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        transition: all 0.3s ease;
      }

      .theme-toggle:hover {
        transform: scale(1.1);
      }

      /* Editable Table Cells */
      .editable {
        background: #f8f9fa;
        border: 1px solid transparent;
        padding: 5px;
        border-radius: 4px;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .editable:hover {
        background: #e9ecef;
        border-color: #3498db;
      }

      .editable:focus {
        outline: none;
        background: white;
        border-color: #3498db;
        box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
      }

      /* Export Options */
      .export-options {
        display: flex;
        gap: 10px;
        align-items: center;
      }

      /* Enhanced Mobile Optimization */
      @media (max-width: 768px) {
        body {
          padding: 16px;
        }
        
        .header h1 {
          font-size: 2rem;
        }
        
        .nav-menu {
          flex-direction: column;
          gap: 10px;
        }
        
        .nav-item {
          padding: 12px 20px;
          font-size: 16px;
          text-align: center;
        }
        
        .grid-2 {
          grid-template-columns: 1fr;
        }
        
        .grid-3 {
          grid-template-columns: 1fr;
        }
        
        .calculator-grid {
          grid-template-columns: 1fr;
        }
        
        .table-controls {
          flex-direction: column;
          align-items: stretch;
        }
        
        .tracking-table {
          font-size: 14px;
        }
        
        .tracking-table th,
        .tracking-table td {
          padding: 8px 4px;
        }
        
        .btn {
          padding: 12px 20px;
          font-size: 16px;
          min-height: 44px;
        }
        
        .form-control {
          padding: 12px 16px;
          font-size: 16px;
          min-height: 44px;
        }
        
        .stat-card {
          padding: 15px;
        }
        
        .stat-number {
          font-size: 2rem;
        }
        
        .chart-container {
          height: 250px;
          padding: 15px;
        }
        
        .section {
          padding: 20px 15px;
        }
        
        .modal-content {
          margin: 10px;
          padding: 20px;
          width: calc(100% - 20px);
        }
        
        .theme-toggle {
          top: 10px;
          right: 10px;
          width: 44px;
          height: 44px;
        }
      }
      
      /* Touch-friendly interactions */
      .btn:hover,
      .nav-item:hover,
      .editable:hover {
        transform: none;
      }
      
      @media (hover: none) {
        .btn:active {
          background-color: rgba(52, 152, 219, 0.8);
          transform: scale(0.98);
        }
        
        .nav-item:active {
          background-color: rgba(236, 240, 241, 0.8);
        }
      }
      
      /* Swipe gestures for tables */
      .table-scroll {
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
        scroll-behavior: smooth;
      }
      
      .tracking-table {
        min-width: 600px;
      }
      
      /* Mobile-specific alerts */
      .mobile-alert {
        position: fixed;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        background: #3498db;
        color: white;
        padding: 12px 20px;
        border-radius: 25px;
        z-index: 1000;
        display: none;
      }
    </style>
  </head>
  <body>
    <!-- Theme Toggle -->
    <button class="theme-toggle" onclick="toggleTheme()" title="Toggle Dark Mode">
      <i class="fas fa-moon" id="theme-icon"></i>
    </button>

    <div class="header">
      <h1>🧬 Peptide Research Dashboard</h1>
      <p>Comprehensive Tracking & Documentation System</p>
      <nav class="nav-menu">
        <a href="#dashboard" class="nav-item">Dashboard</a>
        <a href="#objectives" class="nav-item">Research Objectives</a>
        <a href="#reconstitution" class="nav-item">Reconstitution</a>
        <a href="#protocols" class="nav-item">Protocols</a>
        <a href="#stockpile" class="nav-item">Stockpile</a>
        <a href="#vendors" class="nav-item">Vendors</a>
        <a href="#biomarkers" class="nav-item">Biomarkers</a>
        <a href="#calculators" class="nav-item">Calculators</a>
        <a href="#cheatsheet" class="nav-item">Cheat Sheet</a>
        <a href="#settings" class="nav-item">Settings</a>
      </nav>
    </div>

    <!-- Dashboard Overview Section -->
    <section id="dashboard" class="section">
      <h2><i class="fas fa-chart-dashboard"></i> Dashboard Overview</h2>
      
      <!-- Key Metrics -->
      <div class="dashboard-stats">
        <div class="stat-card">
          <div class="stat-number" id="active-protocols">3</div>
          <div class="stat-label">Active Protocols</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="total-peptides">12</div>
          <div class="stat-label">Peptides in Stock</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="weight-change">-8</div>
          <div class="stat-label">lbs Lost This Month</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="compliance-rate">87</div>
          <div class="stat-label">% Protocol Compliance</div>
        </div>
      </div>

      <!-- Progress Charts -->
      <div class="grid-2">
        <div class="chart-container">
          <h3>Weight Progress</h3>
          <canvas id="weightChart"></canvas>
        </div>
        <div class="chart-container">
          <h3>Protocol Compliance</h3>
          <canvas id="complianceChart"></canvas>
        </div>
      </div>

      <!-- Alerts & Notifications -->
      <div class="alerts-section">
        <h3><i class="fas fa-bell"></i> Alerts & Notifications</h3>
        <div class="alert alert-warning">
          <strong><i class="fas fa-exclamation-triangle"></i> Expiry Alert:</strong> BPC-157 vial expires in 15 days. Consider reordering.
        </div>
        <div class="alert alert-info">
          <strong><i class="fas fa-info-circle"></i> Protocol Update:</strong> Week 6 of CJC-1295 protocol. Consider biomarker testing.
        </div>
        <div class="alert alert-danger">
          <strong><i class="fas fa-thermometer-half"></i> Temperature Alert:</strong> Refrigerator temperature exceeded 8°C yesterday.
        </div>
      </div>
    </section>

    <section id="objectives" class="section">
      <h2>Research Objectives</h2>

      <div class="grid-2">
        <div class="subsection">
          <h3>Exercise Plan Tracking</h3>
          <table class="tracking-table">
            <thead>
              <tr>
                <th>Exercise Type</th>
                <th>Frequency</th>
                <th>Duration</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Resistance Training</td>
                <td>3x/week</td>
                <td>60 min</td>
                <td class="status-active">Active</td>
              </tr>
              <tr>
                <td>Cardio</td>
                <td>4x/week</td>
                <td>30 min</td>
                <td class="status-planned">Planned</td>
              </tr>
              <tr>
                <td>Flexibility</td>
                <td>Daily</td>
                <td>15 min</td>
                <td class="status-active">Active</td>
              </tr>
            </tbody>
          </table>
        </div>

        <div class="subsection">
          <h3>Vitamin Regimen</h3>
          <table class="tracking-table">
            <thead>
              <tr>
                <th>Supplement</th>
                <th>Dosage</th>
                <th>Timing</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Vitamin D3</td>
                <td>5000 IU</td>
                <td>Morning</td>
                <td class="status-active">Active</td>
              </tr>
              <tr>
                <td>Magnesium</td>
                <td>400mg</td>
                <td>Evening</td>
                <td class="status-active">Active</td>
              </tr>
              <tr>
                <td>Omega-3</td>
                <td>2g</td>
                <td>With meals</td>
                <td class="status-planned">Planned</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <div class="grid-3">
        <div class="subsection">
          <h3>Sleep Tracking</h3>
          <div class="label">Target: 7-9 hours</div>
          <table class="tracking-table">
            <tr>
              <th>Metric</th>
              <th>Target</th>
              <th>Current</th>
            </tr>
            <tr>
              <td>Bedtime</td>
              <td>10:00 PM</td>
              <td>10:30 PM</td>
            </tr>
            <tr>
              <td>Wake Time</td>
              <td>6:00 AM</td>
              <td>6:15 AM</td>
            </tr>
            <tr>
              <td>Sleep Quality</td>
              <td>8/10</td>
              <td>7/10</td>
            </tr>
          </table>
        </div>

        <div class="subsection">
          <h3>Weight Loss Goals</h3>
          <div class="label">Progress Tracking</div>
          <table class="tracking-table">
            <tr>
              <th>Metric</th>
              <th>Start</th>
              <th>Target</th>
              <th>Current</th>
            </tr>
            <tr>
              <td>Weight</td>
              <td>180 lbs</td>
              <td>165 lbs</td>
              <td>172 lbs</td>
            </tr>
            <tr>
              <td>Body Fat %</td>
              <td>22%</td>
              <td>15%</td>
              <td>19%</td>
            </tr>
            <tr>
              <td>Waist</td>
              <td>36"</td>
              <td>32"</td>
              <td>34"</td>
            </tr>
          </table>
        </div>

        <div class="subsection">
          <h3>Hydration Tracking</h3>
          <div class="label">Daily Water Intake</div>
          <table class="tracking-table">
            <tr>
              <th>Target</th>
              <th>Current</th>
              <th>Notes</th>
            </tr>
            <tr>
              <td>3L/day</td>
              <td>2.5L</td>
              <td>Add electrolytes</td>
            </tr>
          </table>
        </div>
      </div>

      <div class="subsection">
        <h3>Monthly Overview</h3>
        <table class="tracking-table">
          <thead>
            <tr>
              <th>Month</th>
              <th>Weight Change</th>
              <th>Peptide Protocol</th>
              <th>Exercise Compliance</th>
              <th>Key Observations</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>January 2024</td>
              <td>-3 lbs</td>
              <td>BPC-157 + TB-500</td>
              <td>85%</td>
              <td>Improved recovery, better sleep</td>
            </tr>
            <tr>
              <td>February 2024</td>
              <td>-2 lbs</td>
              <td>Semaglutide + CJC-1295</td>
              <td>90%</td>
              <td>Reduced appetite, steady energy</td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="subsection">
        <h3>Weekly Tracker</h3>
        <table class="tracking-table">
          <thead>
            <tr>
              <th>Day</th>
              <th>Peptide Dose</th>
              <th>Exercise</th>
              <th>Sleep (hrs)</th>
              <th>Weight</th>
              <th>Energy (1-10)</th>
              <th>Notes</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Monday</td>
              <td>✓</td>
              <td>Chest/Tri</td>
              <td>7.5</td>
              <td>172</td>
              <td>8</td>
              <td>Good session</td>
            </tr>
            <tr>
              <td>Tuesday</td>
              <td>✓</td>
              <td>Cardio</td>
              <td>8.0</td>
              <td>171</td>
              <td>9</td>
              <td>Great energy</td>
            </tr>
            <tr>
              <td>Wednesday</td>
              <td>✓</td>
              <td>Back/Bi</td>
              <td>7.0</td>
              <td>171</td>
              <td>7</td>
              <td>Slight fatigue</td>
            </tr>
            <tr>
              <td>Thursday</td>
              <td>✓</td>
              <td>Rest</td>
              <td>8.5</td>
              <td>170</td>
              <td>9</td>
              <td>Recovery day</td>
            </tr>
            <tr>
              <td>Friday</td>
              <td>✓</td>
              <td>Legs</td>
              <td>7.5</td>
              <td>171</td>
              <td>8</td>
              <td>Strong workout</td>
            </tr>
            <tr>
              <td>Saturday</td>
              <td>✓</td>
              <td>Cardio</td>
              <td>8.0</td>
              <td>170</td>
              <td>8</td>
              <td>Morning run</td>
            </tr>
            <tr>
              <td>Sunday</td>
              <td>Rest</td>
              <td>Rest</td>
              <td>8.5</td>
              <td>170</td>
              <td>9</td>
              <td>Full recovery</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <section id="reconstitution" class="section">
      <h2><i class="fas fa-flask"></i> Reconstitution Tracker</h2>
      
      <div class="interactive-table">
        <div class="table-controls">
          <div class="search-box">
            <input type="text" class="search-input" placeholder="Search peptides..." id="reconstitution-search">
            <button class="btn btn-primary" onclick="addReconstitutionEntry()">
              <i class="fas fa-plus"></i> Add Entry
            </button>
          </div>
          <div class="export-options">
            <button class="btn btn-success btn-small" onclick="exportData('reconstitution')">
              <i class="fas fa-download"></i> Export CSV
            </button>
            <button class="btn btn-warning btn-small" onclick="exportData('reconstitution', 'json')">
              <i class="fas fa-file-code"></i> JSON
            </button>
          </div>
        </div>
        
        <div class="table-scroll">
          <table class="tracking-table" id="reconstitution-table">
          <thead>
            <tr>
              <th>Peptide</th>
              <th>Vial Size (mg)</th>
              <th>Water Added (ml)</th>
              <th>Concentration</th>
              <th>Date Mixed</th>
              <th>Expiry Date</th>
              <th>Storage Temp</th>
              <th>pH Level</th>
              <th>Notes</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="editable" contenteditable="true">BPC-157</td>
              <td class="editable" contenteditable="true">5mg</td>
              <td class="editable" contenteditable="true">2.5ml</td>
              <td>2mg/ml</td>
              <td class="editable" contenteditable="true">2024-01-15</td>
              <td class="editable" contenteditable="true">2024-02-15</td>
              <td class="editable" contenteditable="true">4°C</td>
              <td class="editable" contenteditable="true">6.8</td>
              <td class="editable" contenteditable="true">Clear solution, no precipitation</td>
              <td>
                <button class="btn btn-danger btn-small" onclick="deleteRow(this)">
                  <i class="fas fa-trash"></i>
                </button>
              </td>
            </tr>
            <tr>
              <td class="editable" contenteditable="true">TB-500</td>
              <td class="editable" contenteditable="true">10mg</td>
              <td class="editable" contenteditable="true">2ml</td>
              <td>5mg/ml</td>
              <td class="editable" contenteditable="true">2024-01-20</td>
              <td class="editable" contenteditable="true">2024-02-20</td>
              <td class="editable" contenteditable="true">4°C</td>
              <td class="editable" contenteditable="true">7.2</td>
              <td class="editable" contenteditable="true">Slight cloudiness normal</td>
              <td>
                <button class="btn btn-danger btn-small" onclick="deleteRow(this)">
                  <i class="fas fa-trash"></i>
                </button>
              </td>
            </tr>
            <tr>
              <td class="editable" contenteditable="true">Semaglutide</td>
              <td class="editable" contenteditable="true">5mg</td>
              <td class="editable" contenteditable="true">2ml</td>
              <td>2.5mg/ml</td>
              <td class="editable" contenteditable="true">2024-02-01</td>
              <td class="editable" contenteditable="true">2024-03-01</td>
              <td class="editable" contenteditable="true">4°C</td>
              <td class="editable" contenteditable="true">7.0</td>
              <td class="editable" contenteditable="true">Store upright, gentle mixing</td>
              <td>
                <button class="btn btn-danger btn-small" onclick="deleteRow(this)">
                  <i class="fas fa-trash"></i>
                </button>
              </td>
            </tr>
          </tbody>
        </table>
        </div>
      </div>

      <!-- Reconstitution Calculator -->
      <div class="subsection">
        <h3><i class="fas fa-calculator"></i> Quick Reconstitution Calculator</h3>
        <div class="calculator-grid">
          <div>
            <div class="form-group">
              <label class="form-label">Peptide Amount (mg):</label>
              <input type="number" class="form-control" id="peptide-amount" placeholder="5">
            </div>
            <div class="form-group">
              <label class="form-label">Desired Concentration (mg/ml):</label>
              <input type="number" class="form-control" id="desired-concentration" placeholder="2">
            </div>
            <button class="btn btn-primary" onclick="calculateReconstitution()">
              <i class="fas fa-calculator"></i> Calculate
            </button>
          </div>
          <div id="reconstitution-result"></div>
        </div>
      </div>
    </section>

    <section id="protocols" class="section">
      <h2>Peptide Protocols</h2>

      <div class="protocol-card">
        <h3>Recovery & Healing Protocol</h3>
        <div class="protocol-grid">
          <div>
            <div class="label">Primary Peptide:</div>
            <div>BPC-157</div>
          </div>
          <div>
            <div class="label">Purpose:</div>
            <div>Tissue repair, gut health, anti-inflammatory</div>
          </div>
          <div>
            <div class="label">Dosage:</div>
            <div>250mcg twice daily</div>
          </div>
          <div>
            <div class="label">Frequency:</div>
            <div>Morning and evening</div>
          </div>
          <div>
            <div class="label">Duration:</div>
            <div>8 weeks</div>
          </div>
          <div>
            <div class="label">Administration:</div>
            <div>Subcutaneous injection</div>
          </div>
          <div>
            <div class="label">Stacks With:</div>
            <div>TB-500, GHK-Cu</div>
          </div>
          <div>
            <div class="label">Follow-up Peptides:</div>
            <div>Maintenance dose or cycle off for 4 weeks</div>
          </div>
        </div>
      </div>

      <div class="protocol-card">
        <h3>Weight Management Protocol</h3>
        <div class="protocol-grid">
          <div>
            <div class="label">Primary Peptide:</div>
            <div>Semaglutide</div>
          </div>
          <div>
            <div class="label">Purpose:</div>
            <div>Appetite suppression, weight loss, glucose control</div>
          </div>
          <div>
            <div class="label">Dosage:</div>
            <div>Start 0.25mg weekly, titrate to 1mg</div>
          </div>
          <div>
            <div class="label">Frequency:</div>
            <div>Once weekly, same day</div>
          </div>
          <div>
            <div class="label">Duration:</div>
            <div>12-16 weeks</div>
          </div>
          <div>
            <div class="label">Administration:</div>
            <div>Subcutaneous injection</div>
          </div>
          <div>
            <div class="label">Stacks With:</div>
            <div>CJC-1295, Ipamorelin</div>
          </div>
          <div>
            <div class="label">Follow-up Peptides:</div>
            <div>Maintenance dose or transition to Tirzepatide</div>
          </div>
        </div>
      </div>

      <div class="protocol-card">
        <h3>Growth Hormone Protocol</h3>
        <div class="protocol-grid">
          <div>
            <div class="label">Primary Peptide:</div>
            <div>CJC-1295 + Ipamorelin</div>
          </div>
          <div>
            <div class="label">Purpose:</div>
            <div>Muscle growth, fat loss, recovery, sleep</div>
          </div>
          <div>
            <div class="label">Dosage:</div>
            <div>100mcg each peptide</div>
          </div>
          <div>
            <div class="label">Frequency:</div>
            <div>Before bed, 5 days on, 2 days off</div>
          </div>
          <div>
            <div class="label">Duration:</div>
            <div>12 weeks</div>
          </div>
          <div>
            <div class="label">Administration:</div>
            <div>Subcutaneous injection</div>
          </div>
          <div>
            <div class="label">Stacks With:</div>
            <div>MK-677, Tesamorelin</div>
          </div>
          <div>
            <div class="label">Follow-up Peptides:</div>
            <div>2-4 week break, then repeat cycle</div>
          </div>
        </div>
      </div>
    </section>

    <section id="stockpile" class="section">
      <h2>Peptide Stockpile Inventory</h2>
      <table class="tracking-table">
        <thead>
          <tr>
            <th>Peptide</th>
            <th>Vials/Kits</th>
            <th>Vendor</th>
            <th>Cap Color</th>
            <th>Test mg/%</th>
            <th>Purchase Date</th>
            <th>Expiry Date</th>
            <th>Order #</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>BPC-157</td>
            <td>3 vials</td>
            <td>PeptideSciences</td>
            <td>Blue</td>
            <td>5.2mg / 104%</td>
            <td>2024-01-10</td>
            <td>2025-01-10</td>
            <td>PS2024001</td>
            <td class="status-active">In Use</td>
          </tr>
          <tr>
            <td>TB-500</td>
            <td>2 vials</td>
            <td>Research Chems</td>
            <td>Red</td>
            <td>10.1mg / 101%</td>
            <td>2024-01-15</td>
            <td>2026-01-15</td>
            <td>RC2024003</td>
            <td class="status-active">In Use</td>
          </tr>
          <tr>
            <td>Semaglutide</td>
            <td>1 kit</td>
            <td>Amino Asylum</td>
            <td>Green</td>
            <td>5.0mg / 100%</td>
            <td>2024-02-01</td>
            <td>2025-02-01</td>
            <td>AA2024015</td>
            <td class="status-active">In Use</td>
          </tr>
          <tr>
            <td>CJC-1295</td>
            <td>4 vials</td>
            <td>PeptideSciences</td>
            <td>White</td>
            <td>2.1mg / 105%</td>
            <td>2024-01-20</td>
            <td>2025-01-20</td>
            <td>PS2024005</td>
            <td class="status-planned">Backup</td>
          </tr>
          <tr>
            <td>Ipamorelin</td>
            <td>4 vials</td>
            <td>Research Chems</td>
            <td>Yellow</td>
            <td>2.0mg / 100%</td>
            <td>2024-01-20</td>
            <td>2025-01-20</td>
            <td>RC2024007</td>
            <td class="status-planned">Backup</td>
          </tr>
          <tr>
            <td>Tirzepatide</td>
            <td>1 kit</td>
            <td>Amino Asylum</td>
            <td>Purple</td>
            <td>10.2mg / 102%</td>
            <td>2024-02-05</td>
            <td>2025-02-05</td>
            <td>AA2024018</td>
            <td class="status-planned">Future Use</td>
          </tr>
        </tbody>
      </table>
    </section>

    <!-- Biomarkers Tracking Section -->
    <section id="biomarkers" class="section">
      <h2><i class="fas fa-heartbeat"></i> Biomarker Tracking</h2>
      
      <div class="interactive-table">
        <div class="table-controls">
          <div class="search-box">
            <input type="text" class="search-input" placeholder="Search biomarkers..." id="biomarker-search">
            <button class="btn btn-primary" onclick="addBiomarkerEntry()">
              <i class="fas fa-plus"></i> Add Test
            </button>
          </div>
          <div class="export-options">
            <button class="btn btn-success btn-small" onclick="exportData('biomarkers')">
              <i class="fas fa-download"></i> Export CSV
            </button>
            <button class="btn btn-warning btn-small" onclick="exportData('biomarkers', 'json')">
              <i class="fas fa-file-code"></i> JSON
            </button>
            <button class="btn btn-primary btn-small" onclick="uploadLabResults()">
              <i class="fas fa-upload"></i> Upload Lab
            </button>
          </div>
        </div>
        
        <table class="tracking-table" id="biomarkers-table">
          <thead>
            <tr>
              <th>Test Date</th>
              <th>Biomarker</th>
              <th>Value</th>
              <th>Unit</th>
              <th>Reference Range</th>
              <th>Status</th>
              <th>Protocol Phase</th>
              <th>Notes</th>
              <th>Trend</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="editable" contenteditable="true">2024-01-15</td>
              <td class="editable" contenteditable="true">IGF-1</td>
              <td class="editable" contenteditable="true">185</td>
              <td>ng/ml</td>
              <td>115-307</td>
              <td class="status-active">Normal</td>
              <td class="editable" contenteditable="true">Baseline</td>
              <td class="editable" contenteditable="true">Pre-protocol baseline</td>
              <td><i class="fas fa-arrow-up" style="color: green;"></i></td>
              <td>
                <button class="btn btn-danger btn-small" onclick="deleteRow(this)">
                  <i class="fas fa-trash"></i>
                </button>
              </td>
            </tr>
            <tr>
              <td class="editable" contenteditable="true">2024-02-15</td>
              <td class="editable" contenteditable="true">IGF-1</td>
              <td class="editable" contenteditable="true">245</td>
              <td>ng/ml</td>
              <td>115-307</td>
              <td class="status-active">Normal</td>
              <td class="editable" contenteditable="true">Week 4 CJC</td>
              <td class="editable" contenteditable="true">Significant improvement</td>
              <td><i class="fas fa-arrow-up" style="color: green;"></i></td>
              <td>
                <button class="btn btn-danger btn-small" onclick="deleteRow(this)">
                  <i class="fas fa-trash"></i>
                </button>
              </td>
            </tr>
            <tr>
              <td class="editable" contenteditable="true">2024-01-15</td>
              <td class="editable" contenteditable="true">HbA1c</td>
              <td class="editable" contenteditable="true">6.2</td>
              <td>%</td>
              <td>4.0-5.6</td>
              <td class="status-planned">Elevated</td>
              <td class="editable" contenteditable="true">Pre-Semaglutide</td>
              <td class="editable" contenteditable="true">Target for improvement</td>
              <td><i class="fas fa-arrow-down" style="color: red;"></i></td>
              <td>
                <button class="btn btn-danger btn-small" onclick="deleteRow(this)">
                  <i class="fas fa-trash"></i>
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Biomarker Charts -->
      <div class="grid-2">
        <div class="chart-container">
          <h3>IGF-1 Trends</h3>
          <canvas id="igf1Chart"></canvas>
        </div>
        <div class="chart-container">
          <h3>Glucose Markers</h3>
          <canvas id="glucoseChart"></canvas>
        </div>
      </div>
    </section>

    <!-- Advanced Calculators Section -->
    <section id="calculators" class="section">
      <h2><i class="fas fa-calculator"></i> Advanced Calculators</h2>
      
      <div class="grid-2">
        <!-- Dosage Calculator -->
        <div class="subsection">
          <h3><i class="fas fa-syringe"></i> Dosage Calculator</h3>
          <div class="form-group">
            <label class="form-label">Body Weight (kg):</label>
            <input type="number" class="form-control" id="body-weight" placeholder="70">
          </div>
          <div class="form-group">
            <label class="form-label">Peptide:</label>
            <select class="form-control" id="peptide-select">
              <option value="bpc157">BPC-157</option>
              <option value="tb500">TB-500</option>
              <option value="semaglutide">Semaglutide</option>
              <option value="cjc1295">CJC-1295</option>
              <option value="ipamorelin">Ipamorelin</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Experience Level:</label>
            <select class="form-control" id="experience-level">
              <option value="beginner">Beginner</option>
              <option value="intermediate">Intermediate</option>
              <option value="advanced">Advanced</option>
            </select>
          </div>
          <button class="btn btn-primary" onclick="calculateDosage()">Calculate Optimal Dosage</button>
          <div id="dosage-result"></div>
        </div>

        <!-- Half-Life & Timing Calculator -->
        <div class="subsection">
          <h3><i class="fas fa-clock"></i> Half-Life & Timing Calculator</h3>
          <div class="form-group">
            <label class="form-label">Peptide Half-Life (hours):</label>
            <input type="number" class="form-control" id="half-life" placeholder="4">
          </div>
          <div class="form-group">
            <label class="form-label">Initial Dose (mg):</label>
            <input type="number" class="form-control" id="initial-dose" placeholder="1">
          </div>
          <div class="form-group">
            <label class="form-label">Target Level (% of initial):</label>
            <input type="number" class="form-control" id="target-level" placeholder="50">
          </div>
          <button class="btn btn-primary" onclick="calculateTiming()">Calculate Next Dose Time</button>
          <div id="timing-result"></div>
        </div>
      </div>

      <!-- Cost Analysis Calculator -->
      <div class="subsection">
        <h3><i class="fas fa-dollar-sign"></i> Cost Analysis Calculator</h3>
        <div class="calculator-grid">
          <div>
            <div class="form-group">
              <label class="form-label">Monthly Peptide Budget ($):</label>
              <input type="number" class="form-control" id="monthly-budget" placeholder="500">
            </div>
            <div class="form-group">
              <label class="form-label">Current Monthly Spend ($):</label>
              <input type="number" class="form-control" id="current-spend" placeholder="320">
            </div>
            <div class="form-group">
              <label class="form-label">Protocol Duration (weeks):</label>
              <input type="number" class="form-control" id="protocol-duration" placeholder="12">
            </div>
            <button class="btn btn-primary" onclick="calculateCost()">Analyze Costs</button>
          </div>
          <div id="cost-result"></div>
        </div>
      </div>
    </section>

    <section id="vendors" class="section">
      <h2><i class="fas fa-store"></i> Vendor Directory</h2>

      <div class="vendor-card">
        <h3>PeptideSciences</h3>
        <div class="vendor-info">
          <div>
            <div class="label">Contact:</div>
            <div>support@peptidesciences.com</div>
          </div>
          <div>
            <div class="label">Phone:</div>
            <div>1-800-PEPTIDE</div>
          </div>
          <div>
            <div class="label">Buy Type:</div>
            <div>Research chemicals</div>
          </div>
          <div>
            <div class="label">Payments:</div>
            <div>Credit card, Bitcoin, eCheck</div>
          </div>
        </div>
        <div class="label">Notes:</div>
        <p>
          Reliable COAs, fast shipping, good customer service. Often has sales on bulk orders. 3rd party testing
          available.
        </p>
      </div>

      <div class="vendor-card">
        <h3>Research Chemicals Co</h3>
        <div class="vendor-info">
          <div>
            <div class="label">Contact:</div>
            <div>orders@researchchemicals.com</div>
          </div>
          <div>
            <div class="label">Phone:</div>
            <div>1-888-RESEARCH</div>
          </div>
          <div>
            <div class="label">Buy Type:</div>
            <div>Research purposes only</div>
          </div>
          <div>
            <div class="label">Payments:</div>
            <div>Bitcoin, Zelle, wire transfer</div>
          </div>
        </div>
        <div class="label">Notes:</div>
        <p>
          Competitive pricing, good for bulk orders. Shipping takes 7-10 days. Always request COA. Bitcoin discount
          available.
        </p>
      </div>

      <div class="vendor-card">
        <h3>Amino Asylum</h3>
        <div class="vendor-info">
          <div>
            <div class="label">Contact:</div>
            <div>info@aminoasylum.com</div>
          </div>
          <div>
            <div class="label">Phone:</div>
            <div>1-844-AMINO-99</div>
          </div>
          <div>
            <div class="label">Buy Type:</div>
            <div>Research chemicals</div>
          </div>
          <div>
            <div class="label">Payments:</div>
            <div>Credit card, Bitcoin, bank transfer</div>
          </div>
        </div>
        <div class="label">Notes:</div>
        <p>
          Premium quality, higher prices. Excellent for GLP-1 agonists. Fast processing and shipping. Good track record.
        </p>
      </div>

      <div class="vendor-card">
        <h3>Swiss Chems</h3>
        <div class="vendor-info">
          <div>
            <div class="label">Contact:</div>
            <div>support@swisschems.com</div>
          </div>
          <div>
            <div class="label">Phone:</div>
            <div>International only</div>
          </div>
          <div>
            <div class="label">Buy Type:</div>
            <div>Research chemicals</div>
          </div>
          <div>
            <div class="label">Payments:</div>
            <div>Bitcoin, bank transfer</div>
          </div>
        </div>
        <div class="label">Notes:</div>
        <p>
          International shipping, good for EU customers. Higher shipping costs but quality products. Bitcoin preferred
          payment.
        </p>
      </div>
    </section>

    <section id="cheatsheet" class="section">
      <h2>Peptide Reference Cheat Sheet</h2>

      <div class="cheat-category">
        <h4>🏥 Healing & Recovery</h4>
        <div class="peptide-list">
          <div class="peptide-item">
            <div class="peptide-name">BPC-157</div>
            <div class="peptide-purpose">Tissue repair, gut health, anti-inflammatory, wound healing</div>
          </div>
          <div class="peptide-item">
            <div class="peptide-name">TB-500 (Thymosin Beta-4)</div>
            <div class="peptide-purpose">Muscle recovery, injury healing, flexibility, hair growth</div>
          </div>
          <div class="peptide-item">
            <div class="peptide-name">GHK-Cu</div>
            <div class="peptide-purpose">Skin health, collagen production, wound healing, anti-aging</div>
          </div>
          <div class="peptide-item">
            <div class="peptide-name">KPV</div>
            <div class="peptide-purpose">Anti-inflammatory, gut health, skin conditions</div>
          </div>
        </div>
      </div>

      <div class="cheat-category">
        <h4>💪 Growth Hormone & Muscle</h4>
        <div class="peptide-list">
          <div class="peptide-item">
            <div class="peptide-name">CJC-1295</div>
            <div class="peptide-purpose">Growth hormone release, muscle growth, fat loss, sleep</div>
          </div>
          <div class="peptide-item">
            <div class="peptide-name">Ipamorelin</div>
            <div class="peptide-purpose">GH secretion, muscle building, recovery, minimal side effects</div>
          </div>
          <div class="peptide-item">
            <div class="peptide-name">Sermorelin</div>
            <div class="peptide-purpose">Natural GH release, anti-aging, improved sleep quality</div>
          </div>
          <div class="peptide-item">
            <div class="peptide-name">Tesamorelin</div>
            <div class="peptide-purpose">Visceral fat reduction, cognitive enhancement</div>
          </div>
          <div class="peptide-item">
            <div class="peptide-name">MK-677 (Ibutamoren)</div>
            <div class="peptide-purpose">Oral GH secretagogue, appetite increase, sleep improvement</div>
          </div>
        </div>
      </div>

      <div class="cheat-category">
        <h4>⚖️ Weight Management</h4>
        <div class="peptide-list">
          <div class="peptide-item">
            <div class="peptide-name">Semaglutide</div>
            <div class="peptide-purpose">Appetite suppression, weight loss, glucose control</div>
          </div>
          <div class="peptide-item">
            <div class="peptide-name">Tirzepatide</div>
            <div class="peptide-purpose">Dual GLP-1/GIP agonist, superior weight loss</div>
          </div>
          <div class="peptide-item">
            <div class="peptide-name">Liraglutide</div>
            <div class="peptide-purpose">Weight management, diabetes control, daily dosing</div>
          </div>
          <div class="peptide-item">
            <div class="peptide-name">AOD-9604</div>
            <div class="peptide-purpose">Fat burning, cartilage repair, minimal side effects</div>
          </div>
        </div>
      </div>

      <div class="cheat-category">
        <h4>🧠 Cognitive & Nootropic</h4>
        <div class="peptide-list">
          <div class="peptide-item">
            <div class="peptide-name">Noopept</div>
            <div class="peptide-purpose">Memory enhancement, neuroprotection, anxiety reduction</div>
          </div>
          <div class="peptide-item">
            <div class="peptide-name">Semax</div>
            <div class="peptide-purpose">Cognitive enhancement, stress resilience, focus</div>
          </div>
          <div class="peptide-item">
            <div class="peptide-name">Selank</div>
            <div class="peptide-purpose">Anxiety reduction, immune support, cognitive function</div>
          </div>
          <div class="peptide-item">
            <div class="peptide-name">Dihexa</div>
            <div class="peptide-purpose">Neurogenesis, memory formation, learning enhancement</div>
          </div>
        </div>
      </div>

      <div class="cheat-category">
        <h4>🌞 Tanning & Skin</h4>
        <div class="peptide-list">
          <div class="peptide-item">
            <div class="peptide-name">Melanotan II</div>
            <div class="peptide-purpose">Skin tanning, appetite suppression, libido enhancement</div>
          </div>
          <div class="peptide-item">
            <div class="peptide-name">Melanotan I</div>
            <div class="peptide-purpose">Skin darkening, fewer side effects than MT-II</div>
          </div>
          <div class="peptide-item">
            <div class="peptide-name">PT-141 (Bremelanotide)</div>
            <div class="peptide-purpose">Libido enhancement, sexual dysfunction treatment</div>
          </div>
        </div>
      </div>

      <div class="cheat-category">
        <h4>💤 Sleep & Recovery</h4>
        <div class="peptide-list">
          <div class="peptide-item">
            <div class="peptide-name">DSIP</div>
            <div class="peptide-purpose">Deep sleep induction, stress reduction, recovery</div>
          </div>
          <div class="peptide-item">
            <div class="peptide-name">Epitalon</div>
            <div class="peptide-purpose">Telomere extension, circadian rhythm, longevity</div>
          </div>
          <div class="peptide-item">
            <div class="peptide-name">Glycine</div>
            <div class="peptide-purpose">Sleep quality improvement, collagen synthesis</div>
          </div>
        </div>
      </div>

      <div class="cheat-category">
        <h4>⚡ Performance & Energy</h4>
        <div class="peptide-list">
          <div class="peptide-item">
            <div class="peptide-name">Cardarine (GW-501516)</div>
            <div class="peptide-purpose">Endurance enhancement, fat oxidation, metabolic health</div>
          </div>
          <div class="peptide-item">
            <div class="peptide-name">Stenabolic (SR-9009)</div>
            <div class="peptide-purpose">Metabolic enhancement, endurance, fat loss</div>
          </div>
          <div class="peptide-item">
            <div class="peptide-name">MOTS-c</div>
            <div class="peptide-purpose">Mitochondrial function, exercise capacity, longevity</div>
          </div>
        </div>
      </div>
    </section>

    <!-- Settings & Backup Section -->
    <section id="settings" class="section">
      <h2><i class="fas fa-cog"></i> Settings & Data Management</h2>
      
      <div class="grid-2">
        <div class="subsection">
          <h3><i class="fas fa-save"></i> Data Backup & Restore</h3>
          <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 15px;">
            <button class="btn btn-primary" onclick="createFullBackup()">
              <i class="fas fa-download"></i> Create Full Backup
            </button>
            <button class="btn btn-warning" onclick="restoreFromBackup()">
              <i class="fas fa-upload"></i> Restore Backup
            </button>
          </div>
          <p style="font-size: 14px; color: #6c757d;">
            Create a complete backup of all your data including protocols, biomarkers, and settings. 
            Restore from a previous backup file to recover your data.
          </p>
        </div>
        
        <div class="subsection">
          <h3><i class="fas fa-mobile-alt"></i> App Features</h3>
          <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 15px;">
            <button class="btn btn-success" onclick="installPWA()" id="install-btn">
              <i class="fas fa-download"></i> Install as App
            </button>
            <button class="btn btn-info" onclick="testNotifications()">
              <i class="fas fa-bell"></i> Test Notifications
            </button>
          </div>
          <p style="font-size: 14px; color: #6c757d;">
            Install this dashboard as a mobile app for offline access and notifications.
            Works on iOS, Android, and desktop browsers.
          </p>
        </div>
      </div>
      
      <div class="subsection">
        <h3><i class="fas fa-chart-bar"></i> Data Statistics</h3>
        <div class="grid-3">
          <div style="text-align: center; padding: 15px; background: #f8f9fa; border-radius: 8px;">
            <div style="font-size: 1.5rem; font-weight: bold; color: #3498db;" id="total-entries">0</div>
            <div style="font-size: 0.9rem; color: #6c757d;">Total Entries</div>
          </div>
          <div style="text-align: center; padding: 15px; background: #f8f9fa; border-radius: 8px;">
            <div style="font-size: 1.5rem; font-weight: bold; color: #27ae60;" id="data-size">0 KB</div>
            <div style="font-size: 0.9rem; color: #6c757d;">Data Size</div>
          </div>
          <div style="text-align: center; padding: 15px; background: #f8f9fa; border-radius: 8px;">
            <div style="font-size: 1.5rem; font-weight: bold; color: #e74c3c;" id="last-backup">Never</div>
            <div style="font-size: 0.9rem; color: #6c757d;">Last Backup</div>
          </div>
        </div>
      </div>
      
      <div class="subsection">
        <h3><i class="fas fa-shield-alt"></i> Privacy & Security</h3>
        <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 15px;">
          <button class="btn btn-danger" onclick="clearAllData()" style="background: #e74c3c;">
            <i class="fas fa-trash-alt"></i> Clear All Data
          </button>
          <button class="btn btn-warning" onclick="exportAllData()">
            <i class="fas fa-file-export"></i> Export Everything
          </button>
        </div>
        <p style="font-size: 14px; color: #6c757d;">
          <strong>Privacy:</strong> All data is stored locally on your device. No data is sent to external servers.
          Use backup/export to save your data before clearing or switching devices.
        </p>
      </div>
    </section>

    <!-- Modals -->
    <div id="addEntryModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 id="modal-title">Add New Entry</h3>
          <span class="close" onclick="closeModal()">&times;</span>
        </div>
        <div id="modal-body">
          <!-- Dynamic form content will be inserted here -->
        </div>
        <div style="text-align: right; margin-top: 20px;">
          <button class="btn btn-success" id="save-btn" onclick="saveEntry()">Save</button>
          <button class="btn" onclick="closeModal()">Cancel</button>
        </div>
      </div>
    </div>

    <footer style="text-align: center; margin-top: 50px; padding: 20px; border-top: 1px solid #ddd; color: #6c757d">
      <p>
        <strong>Disclaimer:</strong> This dashboard is for research and educational purposes only. Always consult
        healthcare professionals before starting any peptide protocol.
      </p>
      <p style="font-size: 12px">© 2024 Peptide Research Dashboard - For Research Use Only</p>
      
      <!-- PWA Files Reference - Create these as separate files -->
      <!-- 
      manifest.json:
      {
        "name": "Peptide Research Dashboard",
        "short_name": "Peptide Tracker",
        "description": "Comprehensive peptide research tracking and documentation system",
        "start_url": "/",
        "display": "standalone",
        "background_color": "#ffffff",
        "theme_color": "#3498db",
        "orientation": "portrait-primary",
        "icons": [
          {
            "src": "data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 192 192'><rect width='192' height='192' fill='%233498db'/><text x='96' y='120' font-size='120' text-anchor='middle' fill='white'>🧬</text></svg>",
            "sizes": "192x192",
            "type": "image/svg+xml",
            "purpose": "any maskable"
          },
          {
            "src": "data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'><rect width='512' height='512' fill='%233498db'/><text x='256' y='320' font-size='320' text-anchor='middle' fill='white'>🧬</text></svg>",
            "sizes": "512x512",
            "type": "image/svg+xml",
            "purpose": "any maskable"
          }
        ],
        "categories": ["health", "medical", "productivity"],
        "lang": "en",
        "dir": "ltr"
      }
      
      sw.js (Service Worker):
      const CACHE_NAME = 'peptide-dashboard-v1';
      const urlsToCache = [
        '/',
        '/manifest.json',
        'https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css',
        'https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap',
        'https://cdn.jsdelivr.net/npm/chart.js',
        'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css'
      ];

      self.addEventListener('install', event => {
        event.waitUntil(
          caches.open(CACHE_NAME)
            .then(cache => cache.addAll(urlsToCache))
        );
      });

      self.addEventListener('fetch', event => {
        event.respondWith(
          caches.match(event.request)
            .then(response => {
              if (response) {
                return response;
              }
              return fetch(event.request);
            }
          )
        );
      });
      -->
    </footer>

    <script>
      // Global Variables
      let currentTheme = 'light';
      let chartInstances = {};
      let isOnline = navigator.onLine;
      let deferredPrompt;
      
      // PWA Installation Support
      window.addEventListener('beforeinstallprompt', (e) => {
        e.preventDefault();
        deferredPrompt = e;
        showInstallBanner();
      });
      
      function showInstallBanner() {
        const banner = document.createElement('div');
        banner.className = 'mobile-alert';
        banner.innerHTML = `
          <i class="fas fa-download"></i> Install as App
          <button onclick="installPWA()" style="margin-left: 10px; background: white; color: #3498db; border: none; padding: 5px 10px; border-radius: 15px;">Install</button>
          <button onclick="this.parentElement.remove()" style="margin-left: 5px; background: transparent; color: white; border: none;">×</button>
        `;
        banner.style.display = 'block';
        document.body.appendChild(banner);
      }
      
      function installPWA() {
        if (deferredPrompt) {
          deferredPrompt.prompt();
          deferredPrompt.userChoice.then((choiceResult) => {
            if (choiceResult.outcome === 'accepted') {
              console.log('User accepted the install prompt');
            }
            deferredPrompt = null;
          });
        }
      }
      
      // Service Worker Registration
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('sw.js')
            .then((registration) => {
              console.log('SW registered: ', registration);
            })
            .catch((registrationError) => {
              console.log('SW registration failed: ', registrationError);
            });
        });
      }
      
      // Online/Offline Status
      window.addEventListener('online', () => {
        isOnline = true;
        showConnectionStatus('Connected', '#27ae60');
      });
      
      window.addEventListener('offline', () => {
        isOnline = false;
        showConnectionStatus('Offline Mode', '#e74c3c');
      });
      
      function showConnectionStatus(message, color) {
        const status = document.createElement('div');
        status.className = 'mobile-alert';
        status.style.backgroundColor = color;
        status.textContent = message;
        status.style.display = 'block';
        document.body.appendChild(status);
        
        setTimeout(() => {
          status.remove();
        }, 3000);
      }

      // Theme Toggle Functionality
      function toggleTheme() {
        currentTheme = currentTheme === 'light' ? 'dark' : 'light';
        document.documentElement.setAttribute('data-theme', currentTheme);
        const icon = document.getElementById('theme-icon');
        icon.className = currentTheme === 'light' ? 'fas fa-moon' : 'fas fa-sun';
        localStorage.setItem('theme', currentTheme);
      }

      // Load saved theme
      document.addEventListener('DOMContentLoaded', function() {
        const savedTheme = localStorage.getItem('theme') || 'light';
        currentTheme = savedTheme;
        document.documentElement.setAttribute('data-theme', savedTheme);
        const icon = document.getElementById('theme-icon');
        icon.className = savedTheme === 'light' ? 'fas fa-moon' : 'fas fa-sun';
        
        initializeCharts();
        initializeSearch();
        updateDashboardStats();
        loadDataFromStorage();
        updateDataStats();
        
        // Initialize PWA features
        if (deferredPrompt) {
          document.getElementById('install-btn').style.display = 'block';
        } else {
          document.getElementById('install-btn').style.display = 'none';
        }
      });

      // Initialize Charts
      function initializeCharts() {
        // Weight Progress Chart
        const weightCtx = document.getElementById('weightChart');
        if (weightCtx) {
          chartInstances.weight = new Chart(weightCtx, {
            type: 'line',
            data: {
              labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4', 'Week 5', 'Week 6'],
              datasets: [{
                label: 'Weight (lbs)',
                data: [180, 178, 176, 174, 173, 172],
                borderColor: '#3498db',
                backgroundColor: 'rgba(52, 152, 219, 0.1)',
                tension: 0.4
              }]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              scales: {
                y: {
                  beginAtZero: false,
                  min: 165
                }
              }
            }
          });
        }

        // Compliance Chart
        const complianceCtx = document.getElementById('complianceChart');
        if (complianceCtx) {
          chartInstances.compliance = new Chart(complianceCtx, {
            type: 'doughnut',
            data: {
              labels: ['Compliant', 'Missed'],
              datasets: [{
                data: [87, 13],
                backgroundColor: ['#27ae60', '#e74c3c'],
                borderWidth: 0
              }]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                legend: {
                  position: 'bottom'
                }
              }
            }
          });
        }

        // IGF-1 Trends Chart
        const igf1Ctx = document.getElementById('igf1Chart');
        if (igf1Ctx) {
          chartInstances.igf1 = new Chart(igf1Ctx, {
            type: 'line',
            data: {
              labels: ['Baseline', 'Week 2', 'Week 4', 'Week 6'],
              datasets: [{
                label: 'IGF-1 (ng/ml)',
                data: [185, 205, 245, 265],
                borderColor: '#9b59b6',
                backgroundColor: 'rgba(155, 89, 182, 0.1)',
                tension: 0.4
              }]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false
            }
          });
        }

        // Glucose Chart
        const glucoseCtx = document.getElementById('glucoseChart');
        if (glucoseCtx) {
          chartInstances.glucose = new Chart(glucoseCtx, {
            type: 'bar',
            data: {
              labels: ['Baseline', 'Month 1', 'Month 2'],
              datasets: [{
                label: 'HbA1c (%)',
                data: [6.2, 5.8, 5.4],
                backgroundColor: '#f39c12',
                borderColor: '#e67e22',
                borderWidth: 1
              }]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              scales: {
                y: {
                  beginAtZero: false,
                  min: 4
                }
              }
            }
          });
        }
      }

      // Search Functionality
      function initializeSearch() {
        const searchInputs = document.querySelectorAll('.search-input');
        searchInputs.forEach(input => {
          input.addEventListener('input', function() {
            const searchTerm = this.value.toLowerCase();
            const tableId = this.id.replace('-search', '-table');
            const table = document.getElementById(tableId);
            if (table) {
              const rows = table.querySelectorAll('tbody tr');
              rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
              });
            }
          });
        });
      }

      // Modal Functions
      function openModal(title, bodyContent) {
        document.getElementById('modal-title').textContent = title;
        document.getElementById('modal-body').innerHTML = bodyContent;
        document.getElementById('addEntryModal').style.display = 'block';
      }

      function closeModal() {
        document.getElementById('addEntryModal').style.display = 'none';
      }

      function addReconstitutionEntry() {
        const formContent = `
          <div class="form-group">
            <label class="form-label">Peptide Name:</label>
            <input type="text" class="form-control" id="new-peptide" placeholder="BPC-157">
          </div>
          <div class="form-group">
            <label class="form-label">Vial Size (mg):</label>
            <input type="number" class="form-control" id="new-vial-size" placeholder="5">
          </div>
          <div class="form-group">
            <label class="form-label">Water Added (ml):</label>
            <input type="number" class="form-control" id="new-water" placeholder="2.5">
          </div>
          <div class="form-group">
            <label class="form-label">Storage Temperature:</label>
            <input type="text" class="form-control" id="new-temp" placeholder="4°C">
          </div>
          <div class="form-group">
            <label class="form-label">Notes:</label>
            <textarea class="form-control" id="new-notes" placeholder="Additional notes..."></textarea>
          </div>
        `;
        openModal('Add Reconstitution Entry', formContent);
      }

      function addBiomarkerEntry() {
        const formContent = `
          <div class="form-group">
            <label class="form-label">Test Date:</label>
            <input type="date" class="form-control" id="new-test-date">
          </div>
          <div class="form-group">
            <label class="form-label">Biomarker:</label>
            <select class="form-control" id="new-biomarker">
              <option value="IGF-1">IGF-1</option>
              <option value="HbA1c">HbA1c</option>
              <option value="Testosterone">Testosterone</option>
              <option value="Growth Hormone">Growth Hormone</option>
              <option value="Cortisol">Cortisol</option>
              <option value="Lipid Panel">Lipid Panel</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Value:</label>
            <input type="number" class="form-control" id="new-value" placeholder="185">
          </div>
          <div class="form-group">
            <label class="form-label">Unit:</label>
            <input type="text" class="form-control" id="new-unit" placeholder="ng/ml">
          </div>
          <div class="form-group">
            <label class="form-label">Protocol Phase:</label>
            <input type="text" class="form-control" id="new-protocol-phase" placeholder="Week 4 CJC">
          </div>
        `;
        openModal('Add Biomarker Test', formContent);
      }

      function saveEntry() {
        alert('Entry saved successfully!');
        closeModal();
      }

      function deleteRow(button) {
        if (confirm('Are you sure you want to delete this entry?')) {
          button.closest('tr').remove();
        }
      }

      // Calculator Functions
      function calculateReconstitution() {
        const peptideAmount = parseFloat(document.getElementById('peptide-amount').value);
        const desiredConcentration = parseFloat(document.getElementById('desired-concentration').value);
        
        if (peptideAmount && desiredConcentration) {
          const waterNeeded = peptideAmount / desiredConcentration;
          const result = `
            <div class="calc-result">
              <strong>Results:</strong><br>
              Water needed: <strong>${waterNeeded.toFixed(2)} ml</strong><br>
              Final concentration: <strong>${desiredConcentration} mg/ml</strong><br>
              Total volume: <strong>${waterNeeded.toFixed(2)} ml</strong>
            </div>
          `;
          document.getElementById('reconstitution-result').innerHTML = result;
        }
      }

      function calculateDosage() {
        const weight = parseFloat(document.getElementById('body-weight').value);
        const peptide = document.getElementById('peptide-select').value;
        const experience = document.getElementById('experience-level').value;
        
        const dosageMap = {
          'bpc157': { beginner: 2.5, intermediate: 5, advanced: 10 },
          'tb500': { beginner: 2, intermediate: 5, advanced: 10 },
          'semaglutide': { beginner: 0.25, intermediate: 0.5, advanced: 1 },
          'cjc1295': { beginner: 1, intermediate: 2, advanced: 3 },
          'ipamorelin': { beginner: 100, intermediate: 200, advanced: 300 }
        };
        
        if (weight && peptide && experience) {
          const baseDose = dosageMap[peptide][experience];
          const adjustedDose = baseDose * (weight / 70);
          
          const result = `
            <div class="calc-result">
              <strong>Recommended Dosage:</strong><br>
              Base dose: <strong>${baseDose} mcg</strong><br>
              Weight adjusted: <strong>${adjustedDose.toFixed(2)} mcg</strong><br>
              Frequency: <strong>Daily (consult protocols)</strong>
            </div>
          `;
          document.getElementById('dosage-result').innerHTML = result;
        }
      }

      function calculateTiming() {
        const halfLife = parseFloat(document.getElementById('half-life').value);
        const initialDose = parseFloat(document.getElementById('initial-dose').value);
        const targetLevel = parseFloat(document.getElementById('target-level').value);
        
        if (halfLife && initialDose && targetLevel) {
          const timeToTarget = halfLife * Math.log2(100 / targetLevel);
          const remainingAmount = initialDose * (targetLevel / 100);
          
          const result = `
            <div class="calc-result">
              <strong>Timing Results:</strong><br>
              Time to ${targetLevel}%: <strong>${timeToTarget.toFixed(1)} hours</strong><br>
              Remaining amount: <strong>${remainingAmount.toFixed(2)} mg</strong><br>
              Next dose recommended: <strong>${timeToTarget.toFixed(1)} hours from initial dose</strong>
            </div>
          `;
          document.getElementById('timing-result').innerHTML = result;
        }
      }

      function calculateCost() {
        const monthlyBudget = parseFloat(document.getElementById('monthly-budget').value);
        const currentSpend = parseFloat(document.getElementById('current-spend').value);
        const protocolDuration = parseFloat(document.getElementById('protocol-duration').value);
        
        if (monthlyBudget && currentSpend && protocolDuration) {
          const totalCost = currentSpend * (protocolDuration / 4);
          const budgetUtilization = (currentSpend / monthlyBudget) * 100;
          const remaining = monthlyBudget - currentSpend;
          
          const result = `
            <div class="calc-result">
              <strong>Cost Analysis:</strong><br>
              Total protocol cost: <strong>$${totalCost.toFixed(2)}</strong><br>
              Budget utilization: <strong>${budgetUtilization.toFixed(1)}%</strong><br>
              Monthly remaining: <strong>$${remaining.toFixed(2)}</strong><br>
              Cost per week: <strong>$${(currentSpend / 4).toFixed(2)}</strong>
            </div>
          `;
          document.getElementById('cost-result').innerHTML = result;
        }
      }

      // Export Functions
      function exportData(type) {
        const table = document.getElementById(type + '-table');
        if (!table) return;
        
        const data = [];
        const headers = [];
        
        table.querySelectorAll('thead th').forEach(th => {
          if (!th.textContent.includes('Actions')) {
            headers.push(th.textContent.trim());
          }
        });
        
        table.querySelectorAll('tbody tr').forEach(row => {
          const rowData = [];
          row.querySelectorAll('td').forEach((td, index) => {
            if (index < headers.length) {
              rowData.push(td.textContent.trim());
            }
          });
          if (rowData.length > 0) data.push(rowData);
        });
        
        const csvContent = [headers.join(','), ...data.map(row => row.join(','))].join('\n');
        
        const blob = new Blob([csvContent], { type: 'text/csv' });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `${type}-export-${new Date().toISOString().split('T')[0]}.csv`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        window.URL.revokeObjectURL(url);
      }

      function updateDashboardStats() {
        document.getElementById('active-protocols').textContent = '3';
        document.getElementById('total-peptides').textContent = '12';
        document.getElementById('weight-change').textContent = '-8';
        document.getElementById('compliance-rate').textContent = '87';
      }

      function saveData() {
        const data = {
          reconstitution: extractTableData('reconstitution-table'),
          biomarkers: extractTableData('biomarkers-table'),
          protocols: extractProtocolData(),
          objectives: extractObjectivesData(),
          stockpile: extractTableData('stockpile-table') || [],
          lastUpdated: new Date().toISOString(),
          version: '1.0'
        };
        
        // Save to localStorage
        localStorage.setItem('peptideData', JSON.stringify(data));
        
        // Save to IndexedDB for larger data
        saveToIndexedDB(data);
        
        // Show save confirmation
        showNotification('Data saved successfully', 'success');
      }
      
      function extractTableData(tableId) {
        const table = document.getElementById(tableId);
        if (!table) return [];
        
        const data = [];
        const headers = [];
        
        // Get headers
        table.querySelectorAll('thead th').forEach(th => {
          if (!th.textContent.includes('Actions')) {
            headers.push(th.textContent.trim());
          }
        });
        
        // Get data rows
        table.querySelectorAll('tbody tr').forEach(row => {
          const rowData = {};
          row.querySelectorAll('td').forEach((td, index) => {
            if (index < headers.length) {
              rowData[headers[index]] = td.textContent.trim();
            }
          });
          if (Object.keys(rowData).length > 0) data.push(rowData);
        });
        
        return data;
      }
      
      function extractProtocolData() {
        const protocols = [];
        document.querySelectorAll('.protocol-card').forEach(card => {
          const protocolData = {
            name: card.querySelector('h3').textContent,
            details: {}
          };
          
          card.querySelectorAll('.protocol-grid > div').forEach(item => {
            const label = item.querySelector('.label');
            const value = item.textContent.replace(label?.textContent || '', '').trim();
            if (label) {
              protocolData.details[label.textContent.replace(':', '')] = value;
            }
          });
          
          protocols.push(protocolData);
        });
        return protocols;
      }
      
      function extractObjectivesData() {
        const objectives = {};
        
        // Extract weight tracking
        const weightRows = document.querySelectorAll('#objectives .subsection:nth-child(3) table tr');
        objectives.weightTracking = {};
        weightRows.forEach(row => {
          const cells = row.querySelectorAll('td');
          if (cells.length >= 3) {
            objectives.weightTracking[cells[0].textContent] = {
              target: cells[1].textContent,
              current: cells[2].textContent
            };
          }
        });
        
        return objectives;
      }
      
      // IndexedDB Support
      function saveToIndexedDB(data) {
        const request = indexedDB.open('PeptideDB', 1);
        
        request.onupgradeneeded = function(event) {
          const db = event.target.result;
          if (!db.objectStoreNames.contains('peptideData')) {
            db.createObjectStore('peptideData', { keyPath: 'id' });
          }
        };
        
        request.onsuccess = function(event) {
          const db = event.target.result;
          const transaction = db.transaction(['peptideData'], 'readwrite');
          const store = transaction.objectStore('peptideData');
          
          data.id = 'main';
          store.put(data);
        };
      }
      
      function loadDataFromStorage() {
        // Load from localStorage first
        const saved = localStorage.getItem('peptideData');
        if (saved) {
          try {
            const data = JSON.parse(saved);
            populateTablesWithData(data);
            console.log('Data loaded from localStorage');
          } catch (e) {
            console.error('Error parsing saved data:', e);
          }
        }
        
        // Also try IndexedDB
        loadFromIndexedDB();
      }
      
      function loadFromIndexedDB() {
        const request = indexedDB.open('PeptideDB', 1);
        
        request.onsuccess = function(event) {
          const db = event.target.result;
          const transaction = db.transaction(['peptideData'], 'readonly');
          const store = transaction.objectStore('peptideData');
          const getRequest = store.get('main');
          
          getRequest.onsuccess = function() {
            if (getRequest.result) {
              populateTablesWithData(getRequest.result);
              console.log('Data loaded from IndexedDB');
            }
          };
        };
      }
      
      function populateTablesWithData(data) {
        if (data.reconstitution) {
          populateTable('reconstitution-table', data.reconstitution);
        }
        if (data.biomarkers) {
          populateTable('biomarkers-table', data.biomarkers);
        }
        
        updateDashboardStats();
      }
      
      function populateTable(tableId, data) {
        const table = document.getElementById(tableId);
        if (!table || !data.length) return;
        
        const tbody = table.querySelector('tbody');
        if (!tbody) return;
        
        // Add new data (keep existing sample data)
        data.forEach(rowData => {
          const row = document.createElement('tr');
          Object.values(rowData).forEach(cellData => {
            const cell = document.createElement('td');
            cell.className = 'editable';
            cell.contentEditable = true;
            cell.textContent = cellData;
            row.appendChild(cell);
          });
          
          // Add action button
          const actionCell = document.createElement('td');
          actionCell.innerHTML = `
            <button class="btn btn-danger btn-small" onclick="deleteRow(this)">
              <i class="fas fa-trash"></i>
            </button>
          `;
          row.appendChild(actionCell);
          
          tbody.appendChild(row);
        });
      }
      
      // Notification System
      function showNotification(message, type = 'info') {
        const notification = document.createElement('div');
        notification.className = 'mobile-alert';
        notification.style.display = 'block';
        
        const colors = {
          success: '#27ae60',
          error: '#e74c3c',
          warning: '#f39c12',
          info: '#3498db'
        };
        
        notification.style.backgroundColor = colors[type] || colors.info;
        notification.innerHTML = `
          <i class="fas fa-${type === 'success' ? 'check' : type === 'error' ? 'times' : 'info'}"></i>
          ${message}
        `;
        
        document.body.appendChild(notification);
        
        setTimeout(() => {
          notification.remove();
        }, 4000);
      }
      
      // Enhanced Export Functions
      function exportData(type, format = 'csv') {
        const data = extractTableData(type + '-table');
        if (!data.length) {
          showNotification('No data to export', 'warning');
          return;
        }
        
        let content, filename, mimeType;
        
        switch (format) {
          case 'json':
            content = JSON.stringify(data, null, 2);
            filename = `${type}-export-${new Date().toISOString().split('T')[0]}.json`;
            mimeType = 'application/json';
            break;
            
          case 'csv':
          default:
            const headers = Object.keys(data[0]);
            const csvContent = [
              headers.join(','),
              ...data.map(row => headers.map(header => `"${(row[header] || '').replace(/"/g, '""')}"`).join(','))
            ].join('\\n');
            content = csvContent;
            filename = `${type}-export-${new Date().toISOString().split('T')[0]}.csv`;
            mimeType = 'text/csv';
        }
        
        // Download file
        const blob = new Blob([content], { type: mimeType });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        window.URL.revokeObjectURL(url);
        
        showNotification(`${type} data exported as ${format.toUpperCase()}`, 'success');
      }
      
      // Backup and Restore Functions
      function createFullBackup() {
        const allData = {
          peptideData: JSON.parse(localStorage.getItem('peptideData') || '{}'),
          theme: localStorage.getItem('theme'),
          userPreferences: localStorage.getItem('userPreferences') || '{}',
          backupDate: new Date().toISOString(),
          version: '1.0'
        };
        
        const content = JSON.stringify(allData, null, 2);
        const filename = `peptide-dashboard-backup-${new Date().toISOString().split('T')[0]}.json`;
        
        const blob = new Blob([content], { type: 'application/json' });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        window.URL.revokeObjectURL(url);
        
        // Update last backup date
        localStorage.setItem('lastBackup', new Date().toISOString());
        updateDataStats();
        
        showNotification('Full backup created successfully', 'success');
      }
      
      function restoreFromBackup() {
        if (!confirm('This will replace all current data. Are you sure?')) return;
        
        const input = document.createElement('input');
        input.type = 'file';
        input.accept = '.json';
        input.onchange = function(e) {
          const file = e.target.files[0];
          if (file) {
            const reader = new FileReader();
            reader.onload = function(event) {
              try {
                const backupData = JSON.parse(event.target.result);
                
                if (backupData.peptideData) {
                  localStorage.setItem('peptideData', JSON.stringify(backupData.peptideData));
                }
                if (backupData.theme) {
                  localStorage.setItem('theme', backupData.theme);
                }
                if (backupData.userPreferences) {
                  localStorage.setItem('userPreferences', backupData.userPreferences);
                }
                
                showNotification('Backup restored successfully. Refreshing page...', 'success');
                setTimeout(() => window.location.reload(), 2000);
              } catch (error) {
                showNotification('Error: Invalid backup file format', 'error');
              }
            };
            reader.readAsText(file);
          }
        };
        input.click();
      }
      
      function clearAllData() {
        if (!confirm('This will permanently delete ALL data. This cannot be undone. Are you sure?')) return;
        if (!confirm('Last chance! This will delete everything including protocols, biomarkers, and settings.')) return;
        
        localStorage.clear();
        
        // Clear IndexedDB
        const deleteReq = indexedDB.deleteDatabase('PeptideDB');
        deleteReq.onsuccess = () => {
          showNotification('All data cleared. Refreshing page...', 'info');
          setTimeout(() => window.location.reload(), 2000);
        };
      }
      
      function exportAllData() {
        const allData = {
          reconstitution: extractTableData('reconstitution-table'),
          biomarkers: extractTableData('biomarkers-table'),
          protocols: extractProtocolData(),
          objectives: extractObjectivesData(),
          exportDate: new Date().toISOString()
        };
        
        const content = JSON.stringify(allData, null, 2);
        const filename = `peptide-dashboard-complete-export-${new Date().toISOString().split('T')[0]}.json`;
        
        const blob = new Blob([content], { type: 'application/json' });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        window.URL.revokeObjectURL(url);
        
        showNotification('Complete data export created', 'success');
      }
      
      function testNotifications() {
        if ('Notification' in window) {
          if (Notification.permission === 'granted') {
            new Notification('Peptide Dashboard', {
              body: 'Notifications are working! You\\'ll receive reminders for protocols and expiry dates.',
              icon: 'data:image/svg+xml,<svg xmlns=\\'http://www.w3.org/2000/svg\\' viewBox=\\'0 0 100 100\\'><text y=\\'.9em\\' font-size=\\'90\\'>🧬</text></svg>'
            });
            showNotification('Notification test sent!', 'success');
          } else if (Notification.permission !== 'denied') {
            Notification.requestPermission().then(permission => {
              if (permission === 'granted') {
                testNotifications();
              }
            });
          } else {
            showNotification('Notifications are disabled in your browser', 'warning');
          }
        } else {
          showNotification('Notifications not supported in this browser', 'warning');
        }
      }
      
      function updateDataStats() {
        const data = localStorage.getItem('peptideData');
        const totalEntries = data ? Object.values(JSON.parse(data)).reduce((acc, val) => acc + (Array.isArray(val) ? val.length : 0), 0) : 0;
        const dataSize = data ? (new Blob([data]).size / 1024).toFixed(1) : 0;
        const lastBackup = localStorage.getItem('lastBackup');
        
        document.getElementById('total-entries').textContent = totalEntries;
        document.getElementById('data-size').textContent = `${dataSize} KB`;
        document.getElementById('last-backup').textContent = lastBackup ? 
          new Date(lastBackup).toLocaleDateString() : 'Never';
      }

      function uploadLabResults() {
        const input = document.createElement('input');
        input.type = 'file';
        input.accept = '.pdf,.jpg,.png';
        input.onchange = function(e) {
          const file = e.target.files[0];
          if (file) {
            alert(`Lab file "${file.name}" uploaded successfully!`);
          }
        };
        input.click();
      }

      document.addEventListener('input', function(e) {
        if (e.target.classList.contains('editable')) {
          clearTimeout(window.autoSaveTimer);
          window.autoSaveTimer = setTimeout(saveData, 2000);
        }
      });

      window.onclick = function(event) {
        const modal = document.getElementById('addEntryModal');
        if (event.target === modal) {
          closeModal();
        }
      };
    </script>
  </body>
</html>
